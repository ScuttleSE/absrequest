{% extends 'base.html' %}

{% block title %}Settings — ABS Request Manager{% endblock %}

{% block content %}
<div class="mb-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('manager.dashboard') }}">Manager Dashboard</a></li>
      <li class="breadcrumb-item active" aria-current="page">Settings</li>
    </ol>
  </nav>
  <h2>Settings</h2>
</div>

<form method="POST" style="max-width: 560px;">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <!-- ── Search providers ───────────────────────────────────────────────────── -->
  <div class="card shadow-sm mb-4">
    <div class="card-header fw-semibold">
      <i class="bi bi-search me-2"></i>Search Providers
    </div>
    <div class="card-body">
      <p class="text-muted small mb-3">
        Enabled providers are tried in order. If the first returns no results the
        next is tried automatically.
      </p>

      <!-- Audible -->
      <div class="border rounded p-3 mb-3">
        <div class="form-check form-switch mb-2">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            id="audible_enabled"
            name="audible_enabled"
            {% if settings.audible_enabled %}checked{% endif %}
          >
          <label class="form-check-label fw-semibold" for="audible_enabled">
            <span class="badge text-bg-warning text-dark me-1">Audible</span>
            Audible
          </label>
        </div>
        <div class="ms-4">
          <label class="form-label small text-muted mb-1">Regions</label>
          <div class="d-flex flex-wrap gap-2">
            {% for region in audible_regions %}
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                name="audible_regions"
                value="{{ region }}"
                id="region_{{ region }}"
                {% if region in settings.audible_regions %}checked{% endif %}
              >
              <label class="form-check-label" for="region_{{ region }}">
                {{ region | upper }}
              </label>
            </div>
            {% endfor %}
          </div>
          <div class="text-muted small mt-1">All selected regions are searched in parallel.</div>
        </div>
        <div class="ms-4 mt-3">
          <label class="form-label small text-muted mb-1" for="audible_language">Language filter</label>
          <input
            type="text"
            class="form-control form-control-sm"
            id="audible_language"
            name="audible_language"
            value="{{ settings.audible_language }}"
            placeholder="e.g. english, french, german — leave empty for all languages"
            style="max-width: 360px;"
          >
          <div class="text-muted small mt-1">Leave empty to return results in all languages.</div>
        </div>
      </div>

      <!-- Open Library -->
      <div class="border rounded p-3">
        <div class="form-check form-switch">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            id="open_library_enabled"
            name="open_library_enabled"
            {% if settings.open_library_enabled %}checked{% endif %}
          >
          <label class="form-check-label fw-semibold" for="open_library_enabled">
            <span class="badge text-bg-secondary me-1">Open Library</span>
            Open Library
            <span class="fw-normal text-muted small">(fallback)</span>
          </label>
        </div>
        <p class="text-muted small ms-4 mb-0 mt-1">
          Free book metadata from the Internet Archive. No narrator or duration data.
        </p>
      </div>
    </div>
  </div>

  <button type="submit" class="btn btn-primary">
    <i class="bi bi-check-lg me-1"></i>Save Settings
  </button>
</form>
{% endblock %}
